<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archives - Nébuleuse Visuelle (V100.9.30) - SECURED</title>
    
    <script src="security.js"></script>
    <script src="archives-data.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        /* CONFIGURATION DES VARIABLES SYSTEME */
        :root { 
            --noir-fond: #000103; 
            --vhs-vert: #00ff41; 
            --vhs-vert-dim: rgba(0, 255, 65, 0.2);
            --rose-hii: rgba(255, 50, 150, 0.15);
            --bleu-tech: #00ffff; 
            --standard-magenta: #ff00ff; 
            --cosplay-gold: #ffcc00;
            --bordeaux: #6d071a; 
            --active-glow: 0 0 20px rgba(0, 255, 65, 0.4);
            --font-main: 'Courier New', monospace;
        }

        /* RESET & BASE */
        body { 
            margin: 0; 
            background-color: var(--noir-fond); 
            color: white; 
            font-family: var(--font-main); 
            min-height: 100vh; 
            overflow-x: hidden;
            background-attachment: fixed;
        }

        /* --- BACKGROUND ENGINE --- */
        .nebula-layer { position: fixed; inset: 0; z-index: -20; background: radial-gradient(circle at 10% 80%, var(--rose-hii) 0%, transparent 50%); }
        .star-field { 
            position: fixed; width: 300%; height: 300%; top: -100%; left: -100%; z-index: -15; 
            background-image: radial-gradient(1px 1px at 25px 35px, #fff, transparent), radial-gradient(2px 2px at 100px 150px, rgba(255,255,255,0.5), transparent); 
            background-size: 500px 500px, 300px 300px; animation: spin 600s linear infinite; 
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* EFFET VHS / SCANLINE */
        body::before {
            content: " "; display: block; position: fixed; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05));
            z-index: 9999; background-size: 100% 4px, 4px 100%; pointer-events: none; opacity: 0.6;
        }

        /* --- UI OVERLAY --- */
        .osd-header { 
            position: fixed; top: 0; left: 0; right: 0; height: 50px; 
            background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--vhs-vert-dim);
            z-index: 10000; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; font-size: 10px; color: var(--vhs-vert);
        }

        .sys-log { position: fixed; bottom: 20px; left: 20px; width: 250px; font-size: 8px; color: var(--vhs-vert); z-index: 10000; pointer-events: none; }

        /* --- PLANETS FILTERS --- */
        .nav-planets { position: fixed; left: 20px; top: 100px; z-index: 1001; display: flex; flex-direction: column; gap: 30px; }
        .planet-wrapper { position: relative; cursor: pointer; }
        .planet { width: 45px; height: 45px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; }
        .planet:hover { transform: scale(1.3) rotate(15deg); border-color: white; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .planet.active { border-color: var(--vhs-vert); box-shadow: var(--active-glow); }
        
        .p-gold { background: radial-gradient(circle at 30% 30%, #fff, var(--cosplay-gold), #600); }
        .p-blue { background: radial-gradient(circle at 30% 30%, #fff, #00ffff, #001a33); }
        .p-red { background: radial-gradient(circle at 30% 30%, #fff, var(--standard-magenta), #300); }
        
        .planet-label { position: absolute; left: 60px; top: 50%; transform: translateY(-50%); font-size: 9px; letter-spacing: 2px; opacity: 0; transition: 0.3s; pointer-events: none; white-space: nowrap; color: white; border-left: 2px solid var(--vhs-vert); padding-left: 10px; }
        .planet-wrapper:hover .planet-label { opacity: 1; left: 55px; }

        /* --- MAIN CONTENT --- */
        .container { max-width: 1500px; margin: 80px auto; padding: 0 100px; position: relative; z-index: 100; }

        h1.glitch-title { 
            font-size: 2.5rem; text-transform: uppercase; letter-spacing: 15px; margin-bottom: 50px;
            text-shadow: 2px 0 var(--standard-magenta), -2px 0 var(--bleu-tech); animation: glitch-anim 3s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { text-shadow: 2px 0 var(--standard-magenta), -2px 0 var(--bleu-tech); }
            50% { text-shadow: -2px 0 var(--standard-magenta), 2px 0 var(--bleu-tech); transform: skew(1deg); }
            100% { text-shadow: 1px 0 var(--standard-magenta), -1px 0 var(--bleu-tech); }
        }

        /* ROMANS GRID */
        #romans-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; margin-bottom: 50px;
            padding: 20px; background: rgba(0, 255, 65, 0.02); border: 1px solid rgba(255,255,255,0.05);
        }
        .roman-card { 
            background: #000; border: 1px solid #222; padding: 10px; cursor: pointer; transition: 0.4s; position: relative; opacity: 0.6;
        }
        .roman-card:hover, .roman-card.active { opacity: 1; border-color: var(--vhs-vert); background: rgba(0, 255, 65, 0.05); }
        .roman-card img { width: 100%; height: 180px; object-fit: cover; filter: grayscale(100%); transition: 0.4s; }
        .roman-card:hover img { filter: grayscale(0%); }

        /* CARDS & GRID */
        .archive-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 35px; }
        
        .box { 
            background: rgba(5,5,5,0.95); border: 1px solid #1a1a1a; padding: 15px; position: relative;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); clip-path: polygon(0 0, 95% 0, 100% 5%, 100% 100%, 5% 100%, 0 95%);
        }
        .box:hover { transform: translateY(-5px); border-color: #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .image-frame { 
            width: 100%; height: 400px; background: #000; position: relative; border: 1px solid #111; overflow: hidden; 
        }

        /* DECO CARDS (HUD) */
        .card-hud-top { position: absolute; top: 5px; right: 5px; font-size: 7px; color: var(--bleu-tech); text-align: right; z-index: 10; pointer-events: none; }
        .card-hud-bottom { position: absolute; bottom: 5px; left: 5px; font-size: 7px; color: var(--vhs-vert); z-index: 10; pointer-events: none; }
        .scan-line-active { 
            position: absolute; width: 100%; height: 2px; background: rgba(0, 255, 65, 0.3); 
            top: 0; animation: scanMove 4s linear infinite; z-index: 11; pointer-events: none;
        }
        @keyframes scanMove { 0% { top: 0; } 100% { top: 100%; } }

        /* BADGES */
        .badge-inedit { position: absolute; top: 0; left: 0; background: var(--bordeaux); font-size: 8px; padding: 5px 12px; z-index: 20; transform: skewX(-15deg); }
        .badge-master { position: absolute; top: 0; right: 0; background: var(--vhs-vert); color: black; font-size: 8px; padding: 5px 12px; z-index: 20; font-weight: bold; }

        /* LIGHTBOX & MODALS */
        #lightbox { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 100000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(15px); 
        }
        #lightbox img { max-width: 90%; max-height: 90%; border: 1px solid var(--vhs-vert-dim); box-shadow: 0 0 50px rgba(0,0,0,0.8); }

        /* LOADING TERMINAL */
        #loading-overlay { position: fixed; inset: 0; background: black; z-index: 20000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--vhs-vert); }
        .bar-container { width: 300px; height: 2px; background: #111; margin-top: 20px; position: relative; }
        .bar-fill { height: 100%; background: var(--vhs-vert); width: 0%; transition: 0.1s; box-shadow: 0 0 10px var(--vhs-vert); }
    </style>
</head>
<body onload="bootSystem()">

    <div id="loading-overlay">
        <div id="boot-logs" style="font-size: 10px; width: 400px; height: 150px; overflow: hidden; margin-bottom: 20px;"></div>
        <div style="font-size: 12px; letter-spacing: 5px;">INITIALIZING_DATABASE</div>
        <div class="bar-container"><div id="load-bar" class="bar-fill"></div></div>
    </div>

    <div class="osd-header">
        <div>NET_ID: SECURE_NODE_77 | <span id="clock-display"></span></div>
        <div style="letter-spacing: 3px;">NÉBULEUSE VISUELLE V100.9.30</div>
        <div>VRAM: <span id="vram-usage">244MB</span> / 8192MB</div>
    </div>

    <div class="sys-log" id="sys-log">
        [SYSTEM] STANDBY...<br>
        [SIGNAL] STABLE<br>
        [DATA] ENCRYPTED
    </div>

    <div class="nav-planets">
        <div class="planet-wrapper" onclick="setFilter('Fan-Cosplay', this)">
            <div class="planet p-gold"></div><div class="planet-label">SECTEUR_COSPLAY</div>
        </div>
        <div class="planet-wrapper" onclick="setFilter('World', this)">
            <div class="planet p-blue"></div><div class="planet-label">GEOGRAPHIE_ALPHA</div>
        </div>
        <div class="planet-wrapper" onclick="setFilter('Livre', this)">
            <div class="planet p-red"></div><div class="planet-label">ARCHIVES_LITTERAIRES</div>
        </div>
    </div>

    <div class="nebula-layer"></div><div class="star-field"></div>
    <div id="lightbox" onclick="this.style.display='none'"><img src=""></div>

    <div id="app-container" style="display:none; opacity: 0; transition: 2s ease;">
        <div class="container">
            <h1 class="glitch-title">Nébuleuse Visuelle</h1>
            
            <div id="romans-grid"></div>

            <div style="display: flex; gap: 20px; margin-bottom: 40px; align-items: center; background: rgba(255,255,255,0.02); padding: 15px;">
                <span style="font-size: 10px; color: var(--vhs-vert);">> SEARCH_FILES:</span>
                <input type="text" id="search" oninput="refreshDisplay()" placeholder="..." style="background: none; border: none; border-bottom: 1px solid #333; color: var(--bleu-tech); outline: none; width: 300px; font-family: inherit;">
                <div style="flex-grow: 1;"></div>
                <div style="font-size: 9px; color: #555;">FILTRER PAR : <span style="color:white; cursor:pointer;" onclick="setSort('new')">RECENT</span> | <span style="color:white; cursor:pointer;" onclick="setSort('alpha')">ALPHA</span></div>
            </div>

            <div id="main-grid" class="archive-grid"></div>

            <h2 id="cosplay-title" style="display:none; color:var(--cosplay-gold); margin-top: 100px; font-size: 1rem; border-left: 5px solid; padding-left: 20px;">[ TRANSMISSIONS RÉELLES / SECTEUR COSPLAY ]</h2>
            <div id="cosplay-grid" class="archive-grid" style="margin-top: 40px;"></div>
        </div>
    </div>

    <script>
        const UI_CONFIG = {
            currentProjet: new URLSearchParams(window.location.search).get('projet') || 1,
            filter: null,
            sort: 'new',
            romans: [
                { id: 1, nom: "Shadrasy" }, { id: 2, nom: "Nébuleuse Alpha" }, { id: 3, nom: "Projet Onyx" }, 
                { id: 4, nom: "Saga Echo" }, { id: 5, nom: "Protocole Silence" }, { id: 6, nom: "Code Hinaru" }, 
                { id: 7, nom: "Saga Origin" }, { id: 8, nom: "Echo Stellaire" }, { id: 9, nom: "Signal Perdu" }, 
                { id: 10, nom: "Archives W10" }, { id: 11, nom: "Module Externe" }, { id: 12, nom: "L'Eveil" }, 
                { id: 13, nom: "Pipeline Final" }, { id: 14, nom: "Projet 14" }
            ]
        };

        // --- ENGINE FUNCTIONS ---
        function bootSystem() {
            const logs = document.getElementById('boot-logs');
            const messages = [
                "> INITIALIZING KERNEL...", "> LOADING NEBULA_DATA.SYS", "> DECRYPTING ROMAN_ARCHIVES",
                "> CHECKING SECURITY STATUS...", "> ACCESS GRANTED", "> CONNECTING TO SECTOR " + UI_CONFIG.currentProjet
            ];
            
            let i = 0;
            const interval = setInterval(() => {
                if (i < messages.length) {
                    logs.innerHTML += messages[i] + "<br>";
                    document.getElementById('load-bar').style.width = ((i+1) * 16.6) + "%";
                    i++;
                } else {
                    clearInterval(interval);
                    document.getElementById('loading-overlay').style.display = 'none';
                    document.getElementById('app-container').style.display = 'block';
                    setTimeout(() => { document.getElementById('app-container').style.opacity = '1'; }, 100);
                    initApp();
                }
            }, 300);

            // Clock update
            setInterval(() => {
                document.getElementById('clock-display').innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        function initApp() {
            renderRomans();
            refreshDisplay();
            logMessage("DATABASE_ONLINE", "SUCCESS");
        }

        function logMessage(msg, type) {
            const logPanel = document.getElementById('sys-log');
            const timestamp = new Date().toLocaleTimeString().split(' ')[0];
            logPanel.innerHTML = `[${timestamp}] [${type}] ${msg}<br>` + logPanel.innerHTML;
        }

        function renderRomans() {
            const grid = document.getElementById('romans-grid');
            grid.innerHTML = UI_CONFIG.romans.map(r => `
                <div class="roman-card ${r.id == UI_CONFIG.currentProjet ? 'active' : ''}" onclick="changeProjet(${r.id})">
                    <img src="img/roman${r.id}.jpg" onerror="this.src='https://via.placeholder.com/200x300/111/333?text=R${r.id}'">
                    <div style="font-size:9px; margin-top:10px; font-weight:bold;">${r.nom.toUpperCase()}</div>
                    <div style="font-size:7px; color:#555;">VER: 1.0.${r.id}</div>
                </div>
            `).join('');
        }

        function changeProjet(id) {
            const url = new URL(window.location);
            url.searchParams.set('projet', id);
            url.searchParams.set('access', 'granted'); // Persistance accès
            window.location.href = url.href;
        }

        function setFilter(type, el) {
            document.querySelectorAll('.planet').forEach(p => p.classList.remove('active'));
            if (UI_CONFIG.filter === type) {
                UI_CONFIG.filter = null;
                logMessage("FILTER_CLEARED", "INFO");
            } else {
                UI_CONFIG.filter = type;
                el.querySelector('.planet').classList.add('active');
                logMessage("FILTER_SET: " + type, "ACTION");
            }
            refreshDisplay();
        }

        function setSort(mode) {
            UI_CONFIG.sort = mode;
            logMessage("SORT_MODE: " + mode, "INFO");
            refreshDisplay();
        }

        function refreshDisplay() {
            const mainGrid = document.getElementById('main-grid');
            const cosplayGrid = document.getElementById('cosplay-grid');
            const searchVal = document.getElementById('search').value.toLowerCase();
            
            mainGrid.innerHTML = "";
            cosplayGrid.innerHTML = "";

            if (typeof archivesData === 'undefined') return;

            let filtered = archivesData.filter(item => {
                const matchProjet = item.roman == UI_CONFIG.currentProjet;
                const matchType = !UI_CONFIG.filter || item.type === UI_CONFIG.filter;
                const matchSearch = !searchVal || item.nom.toLowerCase().includes(searchVal);
                return matchProjet && matchType && matchSearch;
            });

            // Sorting logic
            if (UI_CONFIG.sort === 'alpha') {
                filtered.sort((a, b) => a.nom.localeCompare(b.nom));
            } else {
                filtered.sort((a, b) => b.id - a.id);
            }

            filtered.forEach(item => {
                const card = createComplexCard(item);
                if (item.type === 'Fan-Cosplay') {
                    cosplayGrid.appendChild(card);
                } else {
                    mainGrid.appendChild(card);
                }
            });

            document.getElementById('cosplay-title').style.display = cosplayGrid.children.length > 0 ? 'block' : 'none';
            document.getElementById('vram-usage').innerText = (filtered.length * 12.4).toFixed(1) + "MB";
        }

        function createComplexCard(item) {
            const box = document.createElement('div');
            box.className = 'box';
            
            const is3D = item.glb && item.glb !== "";
            const media = is3D 
                ? `<model-viewer src="${item.glb}" camera-controls auto-rotate shadow-intensity="1" style="width:100%; height:100%; background:#050505;"></model-viewer>`
                : `<img src="${item.url}" onclick="openLightbox('${item.url}')" style="width:100%; height:100%; object-fit:cover; cursor:pointer;">`;

            box.innerHTML = `
                <div class="card-hud-top">FILE_ID: ${item.id || 'N/A'}<br>ENC: AES-256</div>
                <div class="card-hud-bottom">LATENCY: 14ms<br>SYNC: TRUE</div>
                <div class="scan-line-active"></div>
                ${item.inedit ? '<div class="badge-inedit">INÉDIT</div>' : ''}
                ${(item.nom && item.nom.includes('Hinaru')) ? '<div class="badge-master">MASTER_AUTH</div>' : ''}
                
                <div class="image-frame">${media}</div>
                
                <div style="padding-top:15px; text-align:left;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <span style="color:var(--vhs-vert); font-size:8px;">[ ${item.type.toUpperCase()} ]</span>
                            <div style="font-size:14px; color:white; font-weight:bold; margin-top:3px;">${item.nom}</div>
                        </div>
                        <button onclick="simulateDownload('${item.nom}')" style="background:none; border:1px solid #333; color:#555; font-size:7px; cursor:pointer; padding:3px;">EXTRACT</button>
                    </div>
                    
                    ${item.cosplaySpecs ? `
                        <div style="margin-top:10px; border-left: 2px solid var(--cosplay-gold); padding-left:10px; background: rgba(255,204,0,0.03);">
                            <div style="color:var(--cosplay-gold); font-size:7px; font-weight:bold;">SPECIFICATIONS_COSPLAY:</div>
                            <div style="color:#888; font-size:8px; line-height:1.2;">${item.cosplaySpecs}</div>
                        </div>
                    ` : ''}
                </div>
            `;
            return box;
        }

        function openLightbox(src) {
            const lb = document.getElementById('lightbox');
            lb.querySelector('img').src = src;
            lb.style.display = 'flex';
            logMessage("LIGHTBOX_OPEN: " + src.split('/').pop(), "UI");
        }

        function simulateDownload(name) {
            logMessage("EXTRACTING_FILE: " + name, "ACTION");
            alert("Fichier " + name + " préparé pour l'extraction locale.");
        }
    </script>
</body>
</html>
