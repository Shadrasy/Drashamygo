<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archives - Nébuleuse Visuelle - SYSTEM V2031</title>
    
    <script src="security.js"></script>
    <script src="archives-data.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        :root { 
            --noir-fond: #000103; --vhs-vert: #00ff41; --vhs-vert-dim: rgba(0, 255, 65, 0.2);
            --bleu-tech: #00ffff; --standard-magenta: #ff00ff; --cosplay-gold: #ffcc00;
            --bordeaux: #6d071a; --font-main: 'Courier New', monospace;
            --rose-hii: rgba(255, 50, 150, 0.15);
        }

        body { 
            margin: 0; background-color: var(--noir-fond); color: white; 
            font-family: var(--font-main); overflow-x: hidden; scroll-behavior: smooth;
        }

        /* --- BACKGROUND ENGINE --- */
        .nebula-layer { position: fixed; inset: 0; z-index: -20; background: radial-gradient(circle at 10% 80%, var(--rose-hii) 0%, transparent 50%); }
        .star-field { 
            position: fixed; width: 300%; height: 300%; top: -100%; left: -100%; z-index: -15; 
            background-image: radial-gradient(1px 1px at 25px 35px, #fff, transparent), radial-gradient(2px 2px at 100px 150px, rgba(255,255,255,0.5), transparent); 
            background-size: 500px 500px, 300px 300px; animation: spin 600s linear infinite; 
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* EFFET SCANLINE & GRAIN VHS */
        body::before {
            content: " "; display: block; position: fixed; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                        linear-gradient(90deg, rgba(255,0,0,0.03), rgba(0,255,0,0.01), rgba(0,0,255,0.03));
            z-index: 9999; background-size: 100% 3px, 3px 100%; pointer-events: none; opacity: 0.5;
        }

        /* --- HEADER OSD --- */
        .osd-header { 
            position: fixed; top: 0; left: 0; right: 0; height: 60px; 
            background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--vhs-vert-dim);
            z-index: 10000; display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
        }

        .btn-action {
            background: none; border: 1px solid #444; color: #888;
            padding: 8px 15px; font-size: 10px; cursor: pointer; text-decoration: none;
            transition: 0.3s; text-transform: uppercase; font-family: inherit;
        }
        .btn-action:hover { border-color: white; color: white; box-shadow: 0 0 10px rgba(255,255,255,0.2); }
        .btn-master-on { border-color: var(--vhs-vert); color: var(--vhs-vert); box-shadow: 0 0 15px var(--vhs-vert-dim); }
        .btn-exit { border-color: var(--bordeaux); color: var(--bordeaux); }

        /* --- NAVIGATION PLANÈTES (RÉAJUSTÉE) --- */
        .nav-planets { 
            position: fixed; left: 20px; top: 100px; z-index: 10005; 
            display: flex; flex-direction: column; gap: 25px; 
            padding: 15px; background: rgba(0,0,0,0.4); border-radius: 30px; border-left: 1px solid var(--vhs-vert-dim);
        }
        .planet-box { position: relative; cursor: pointer; display: flex; align-items: center; }
        .planet { 
            width: 45px; height: 45px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); 
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; z-index: 2;
        }
        .planet:hover { transform: scale(1.2) rotate(20deg); border-color: white; box-shadow: 0 0 15px white; }
        .planet.active { border-color: var(--vhs-vert); box-shadow: 0 0 25px var(--vhs-vert); }
        
        .p-gold { background: radial-gradient(circle at 30% 30%, #fff, var(--cosplay-gold), #600); }
        .p-blue { background: radial-gradient(circle at 30% 30%, #fff, #00ffff, #001a33); }
        .p-red { background: radial-gradient(circle at 30% 30%, #fff, var(--standard-magenta), #300); }

        .planet-label { 
            position: absolute; left: 55px; font-size: 9px; opacity: 0; transition: 0.3s; 
            white-space: nowrap; color: var(--vhs-vert); border-left: 2px solid var(--vhs-vert); 
            padding-left: 10px; pointer-events: none;
        }
        .planet-box:hover .planet-label { opacity: 1; left: 65px; }

        /* --- ROMANS GRID (Quick Switch) --- */
        #romans-selector { 
            display: flex; gap: 15px; overflow-x: auto; padding: 10px; 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); margin-bottom: 30px;
        }
        .roman-tab { 
            min-width: 120px; height: 60px; background: #000; border: 1px solid #222; 
            display: flex; align-items: center; justify-content: center; font-size: 9px; 
            cursor: pointer; transition: 0.3s; color: #555; text-align: center;
        }
        .roman-tab.active { border-color: var(--vhs-vert); color: var(--vhs-vert); background: rgba(0,255,65,0.05); }

        /* --- GRID & CARDS --- */
        .container { max-width: 1600px; margin: 100px auto 0 100px; padding-right: 40px; }
        .glitch-title { font-size: 2.5rem; letter-spacing: 15px; margin-bottom: 50px; text-transform: uppercase; text-shadow: 2px 0 var(--standard-magenta), -2px 0 var(--bleu-tech); }
        
        .archive-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 30px; }
        
        .box { 
            background: rgba(5,5,5,0.9); border: 1px solid #1a1a1a; padding: 15px; position: relative; 
            transition: 0.3s; clip-path: polygon(0 0, 95% 0, 100% 5%, 100% 100%, 5% 100%, 0 95%); 
        }
        .box:hover { border-color: #444; transform: translateY(-5px); }

        .image-frame { width: 100%; height: 400px; background: black; overflow: hidden; border: 1px solid #111; position: relative; }
        
        /* HUD ELEMENTS SUR CARTES */
        .card-hud { position: absolute; top: 10px; right: 10px; font-size: 7px; color: var(--bleu-tech); text-align: right; pointer-events: none; }
        .scanline-card { position: absolute; width: 100%; height: 2px; background: rgba(0, 255, 65, 0.1); top: 0; animation: moveScan 3s linear infinite; }
        @keyframes moveScan { from { top: 0; } to { top: 100%; } }

        /* SYSTEM LOG BOTTOM LEFT */
        #sys-logs { position: fixed; bottom: 20px; left: 20px; font-size: 8px; color: var(--vhs-vert); opacity: 0.7; z-index: 10000; }

        /* LOADING OVERLAY */
        #loading-overlay { position: fixed; inset: 0; background: black; z-index: 20000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--vhs-vert); }
        .bar-container { width: 300px; height: 2px; background: #111; margin-top: 20px; }
        .bar-fill { height: 100%; background: var(--vhs-vert); width: 0%; transition: 0.1s; }
    </style>
</head>
<body onload="bootSystem()">

    <div id="loading-overlay">
        <div id="boot-logs" style="font-size: 10px; width: 400px; height: 100px; overflow: hidden; margin-bottom: 20px; color: #555;"></div>
        <div style="font-size: 12px; letter-spacing: 5px;">INITIALIZING_NEBULA_CORE</div>
        <div class="bar-container"><div id="load-bar" class="bar-fill"></div></div>
    </div>

    <div id="sys-logs">
        STATUS: SECURED<br>NODE: 04-HINARU<br>SIGNAL: 99%
    </div>

    <div class="nebula-layer"></div>
    <div class="star-field"></div>

    <div class="osd-header">
        <a href="index.html" class="btn-action btn-exit">← EXIT_TO_MAIN</a>
        <div style="text-align: center;">
            <div style="font-size: 12px; letter-spacing: 5px; color: var(--vhs-vert);">PROTOCOL_HINARU</div>
            <div style="font-size: 8px; color: #555;">SYS_TIME: <span id="clock-display"></span></div>
        </div>
        <button id="master-btn" class="btn-action" onclick="toggleMaster()">MODE: VISITEUR</button>
    </div>

    <div class="nav-planets">
        <div class="planet-box" onclick="filterData('Fan-Cosplay', this)">
            <div class="planet p-gold"></div><span class="planet-label">SECTEUR_COSPLAY</span>
        </div>
        <div class="planet-box" onclick="filterData('World', this)">
            <div class="planet p-blue"></div><span class="planet-label">GEOGRAPHIE_ALPHA</span>
        </div>
        <div class="planet-box" onclick="filterData('Livre', this)">
            <div class="planet p-red"></div><span class="planet-label">ARCHIVES_LIVRES</span>
        </div>
    </div>

    <div id="app-content" style="display:none; opacity:0; transition: 1s;">
        <div class="container">
            <h1 class="glitch-title">Nébuleuse_Visuelle</h1>
            
            <div id="romans-selector"></div>

            <div style="display: flex; gap: 20px; margin-bottom: 40px; background: rgba(255,255,255,0.02); padding: 15px; border: 1px solid rgba(255,255,255,0.05);">
                <span style="font-size: 10px; color: var(--vhs-vert);">> SEARCH_DB:</span>
                <input type="text" id="search" oninput="loadData()" placeholder="..." style="background: none; border: none; border-bottom: 1px solid #333; color: var(--bleu-tech); outline: none; width: 300px; font-family: inherit;">
            </div>

            <div id="gallery" class="archive-grid"></div>
        </div>
    </div>

    <script>
        const STATE = {
            isMaster: new URLSearchParams(window.location.search).get('Hinaru') === 'true',
            projet: new URLSearchParams(window.location.search).get('projet') || 1,
            activeType: null,
            romans: ["Shadrasy", "Nébuleuse Alpha", "Projet Onyx", "Saga Echo", "Code Hinaru"]
        };

        function bootSystem() {
            const logs = document.getElementById('boot-logs');
            const messages = ["> MAPPING_STARS...", "> LOADING_DATABASE...", "> CHECKING_AUTH...", "> ACCESS_GRANTED"];
            let i = 0;
            const interval = setInterval(() => {
                if (i < messages.length) {
                    logs.innerHTML += messages[i] + "<br>";
                    document.getElementById('load-bar').style.width = ((i+1) * 25) + "%";
                    i++;
                } else {
                    clearInterval(interval);
                    document.getElementById('loading-overlay').style.display = 'none';
                    document.getElementById('app-content').style.display = 'block';
                    setTimeout(() => { document.getElementById('app-content').style.opacity = '1'; }, 100);
                    initApp();
                }
            }, 300);

            setInterval(() => {
                document.getElementById('clock-display').innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        function initApp() {
            const btn = document.getElementById('master-btn');
            if (STATE.isMaster) {
                btn.innerText = "MODE: MAÎTRE (ON)";
                btn.classList.add('btn-master-on');
            }
            renderRomans();
            loadData();
        }

        function renderRomans() {
            const selector = document.getElementById('romans-selector');
            selector.innerHTML = STATE.romans.map((name, index) => `
                <div class="roman-tab ${STATE.projet == (index + 1) ? 'active' : ''}" onclick="changeProjet(${index + 1})">
                    PROJET_${index + 1}<br>${name.toUpperCase()}
                </div>
            `).join('');
        }

        function changeProjet(id) {
            const url = new URL(window.location);
            url.searchParams.set('projet', id);
            window.location.href = url.href;
        }

        function toggleMaster() {
            const url = new URL(window.location);
            if (STATE.isMaster) { url.searchParams.delete('Hinaru'); } 
            else { url.searchParams.set('Hinaru', 'true'); url.searchParams.set('access', 'granted'); }
            window.location.href = url.href;
        }

        function filterData(type, el) {
            document.querySelectorAll('.planet').forEach(p => p.classList.remove('active'));
            if (STATE.activeType === type) {
                STATE.activeType = null;
            } else {
                STATE.activeType = type;
                el.querySelector('.planet').classList.add('active');
            }
            loadData();
        }

        function loadData() {
            const container = document.getElementById('gallery');
            const searchVal = document.getElementById('search').value.toLowerCase();
            container.innerHTML = "";

            if (typeof archivesData === 'undefined') return;

            const filtered = archivesData.filter(i => 
                i.roman == STATE.projet && 
                (!STATE.activeType || i.type === STATE.activeType) &&
                (!searchVal || i.nom.toLowerCase().includes(searchVal))
            );

            filtered.forEach(item => {
                const box = document.createElement('div');
                box.className = 'box';
                const is3D = item.glb && item.glb !== "";
                
                box.innerHTML = `
                    <div class="card-hud">ID: ${item.id || '00'} | TYPE: ${item.type.toUpperCase()}</div>
                    <div class="scanline-card"></div>
                    <div class="image-frame">
                        ${is3D ? `<model-viewer src="${item.glb}" camera-controls auto-rotate style="width:100%; height:100%;"></model-viewer>` 
                               : `<img src="${item.url}" style="width:100%; height:100%; object-fit:cover;">`}
                    </div>
                    <div style="margin-top:15px;">
                        <span style="font-size:8px; color:var(--vhs-vert)">[ ARCHIVE_FILE ]</span>
                        <div style="font-weight:bold; font-size:14px; color:white;">${item.nom}</div>
                        ${STATE.isMaster ? `
                            <div style="margin-top:10px; border-top:1px solid #222; padding-top:10px; display:flex; gap:10px;">
                                <button onclick="alert('EDIT: ${item.nom}')" style="background:var(--vhs-vert); color:black; border:none; padding:5px 10px; font-size:9px; font-weight:bold; cursor:pointer;">EDIT</button>
                                <button onclick="alert('DEL: ${item.nom}')" style="background:var(--bordeaux); color:white; border:none; padding:5px 10px; font-size:9px; font-weight:bold; cursor:pointer;">DELETE</button>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(box);
            });
        }
    </script>
</body>
</html>
